function getScore() {
    switch (parseInt(arguments[0])) {
        case 0:
            return `
            <img src="/src/rate_star_after_half-left.png" height="50" width="25" onclick="set(0,${arguments[1]},true)"><img src="/src/rate_star_before_half-right.png" height="50" width="25" onclick="set(1,${arguments[1]},false)">
            <img src="/src/rate_star_before_half-left.png" height="50" width="25" onclick="set(2,${arguments[1]},true)"><img src="/src/rate_star_before_half-right.png" height="50" width="25" onclick="set(3,${arguments[1]},false)">
            <img src="/src/rate_star_before_half-left.png" height="50" width="25" onclick="set(4,${arguments[1]},true)"><img src="/src/rate_star_before_half-right.png" height="50" width="25" onclick="set(5,${arguments[1]},false)">
            <img src="/src/rate_star_before_half-left.png" height="50" width="25" onclick="set(6,${arguments[1]},true)"><img src="/src/rate_star_before_half-right.png" height="50" width="25" onclick="set(7,${arguments[1]},false)">
            <img src="/src/rate_star_before_half-left.png" height="50" width="25" onclick="set(8,${arguments[1]},true)"><img src="/src/rate_star_before_half-right.png" height="50" width="25" onclick="set(9,${arguments[1]},false)">`
        case 1:
            return `
            <img src="/src/rate_star_after_half-left.png" height="50" width="25" onclick="set(0,${arguments[1]},true)"><img src="/src/rate_star_after_half-right.png" height="50" width="25" onclick="set(1,${arguments[1]},false)">
            <img src="/src/rate_star_before_half-left.png" height="50" width="25" onclick="set(2,${arguments[1]},true)"><img src="/src/rate_star_before_half-right.png" height="50" width="25" onclick="set(3,${arguments[1]},false)">
            <img src="/src/rate_star_before_half-left.png" height="50" width="25" onclick="set(4,${arguments[1]},true)"><img src="/src/rate_star_before_half-right.png" height="50" width="25" onclick="set(5,${arguments[1]},false)">
            <img src="/src/rate_star_before_half-left.png" height="50" width="25" onclick="set(6,${arguments[1]},true)"><img src="/src/rate_star_before_half-right.png" height="50" width="25" onclick="set(7,${arguments[1]},false)">
            <img src="/src/rate_star_before_half-left.png" height="50" width="25" onclick="set(8,${arguments[1]},true)"><img src="/src/rate_star_before_half-right.png" height="50" width="25" onclick="set(9,${arguments[1]},false)">`
        case 2:
            return `
            <img src="/src/rate_star_after_half-left.png" height="50" width="25" onclick="set(0,${arguments[1]},true)"><img src="/src/rate_star_after_half-right.png" height="50" width="25" onclick="set(1,${arguments[1]},false)">
            <img src="/src/rate_star_after_half-left.png" height="50" width="25" onclick="set(2,${arguments[1]},true)"><img src="/src/rate_star_before_half-right.png" height="50" width="25" onclick="set(3,${arguments[1]},false)">
            <img src="/src/rate_star_before_half-left.png" height="50" width="25" onclick="set(4,${arguments[1]},true)"><img src="/src/rate_star_before_half-right.png" height="50" width="25" onclick="set(5,${arguments[1]},false)">
            <img src="/src/rate_star_before_half-left.png" height="50" width="25" onclick="set(6,${arguments[1]},true)"><img src="/src/rate_star_before_half-right.png" height="50" width="25" onclick="set(7,${arguments[1]},false)">
            <img src="/src/rate_star_before_half-left.png" height="50" width="25" onclick="set(8,${arguments[1]},true)"><img src="/src/rate_star_before_half-right.png" height="50" width="25" onclick="set(9,${arguments[1]},false)">`
        case 3:
            return `
            <img src="/src/rate_star_after_half-left.png" height="50" width="25" onclick="set(0,${arguments[1]},true)"><img src="/src/rate_star_after_half-right.png" height="50" width="25" onclick="set(1,${arguments[1]},false)">
            <img src="/src/rate_star_after_half-left.png" height="50" width="25" onclick="set(2,${arguments[1]},true)"><img src="/src/rate_star_after_half-right.png" height="50" width="25" onclick="set(3,${arguments[1]},false)">
            <img src="/src/rate_star_before_half-left.png" height="50" width="25" onclick="set(4,${arguments[1]},true)"><img src="/src/rate_star_before_half-right.png" height="50" width="25" onclick="set(5,${arguments[1]},false)">
            <img src="/src/rate_star_before_half-left.png" height="50" width="25" onclick="set(6,${arguments[1]},true)"><img src="/src/rate_star_before_half-right.png" height="50" width="25" onclick="set(7,${arguments[1]},false)">
            <img src="/src/rate_star_before_half-left.png" height="50" width="25" onclick="set(8,${arguments[1]},true)"><img src="/src/rate_star_before_half-right.png" height="50" width="25" onclick="set(9,${arguments[1]},false)">`
        case 4:
            return `
            <img src="/src/rate_star_after_half-left.png" height="50" width="25" onclick="set(0,${arguments[1]},true)"><img src="/src/rate_star_after_half-right.png" height="50" width="25" onclick="set(1,${arguments[1]},false)">
            <img src="/src/rate_star_after_half-left.png" height="50" width="25" onclick="set(2,${arguments[1]},true)"><img src="/src/rate_star_after_half-right.png" height="50" width="25" onclick="set(3,${arguments[1]},false)">
            <img src="/src/rate_star_after_half-left.png" height="50" width="25" onclick="set(4,${arguments[1]},true)"><img src="/src/rate_star_before_half-right.png" height="50" width="25" onclick="set(5,${arguments[1]},false)">
            <img src="/src/rate_star_before_half-left.png" height="50" width="25" onclick="set(6,${arguments[1]},true)"><img src="/src/rate_star_before_half-right.png" height="50" width="25" onclick="set(7,${arguments[1]},false)">
            <img src="/src/rate_star_before_half-left.png" height="50" width="25" onclick="set(8,${arguments[1]},true)"><img src="/src/rate_star_before_half-right.png" height="50" width="25" onclick="set(9,${arguments[1]},false)">`
        case 5: return `
            <img src="/src/rate_star_after_half-left.png" height="50" width="25" onclick="set(0,${arguments[1]},true)"><img src="/src/rate_star_after_half-right.png" height="50" width="25" onclick="set(1,${arguments[1]},false)">
            <img src="/src/rate_star_after_half-left.png" height="50" width="25" onclick="set(2,${arguments[1]},true)"><img src="/src/rate_star_after_half-right.png" height="50" width="25" onclick="set(3,${arguments[1]},false)">
            <img src="/src/rate_star_after_half-left.png" height="50" width="25" onclick="set(4,${arguments[1]},true)"><img src="/src/rate_star_after_half-right.png" height="50" width="25" onclick="set(5,${arguments[1]},false)">
            <img src="/src/rate_star_before_half-left.png" height="50" width="25" onclick="set(6,${arguments[1]},true)"><img src="/src/rate_star_before_half-right.png" height="50" width="25" onclick="set(7,${arguments[1]},false)">
            <img src="/src/rate_star_before_half-left.png" height="50" width="25" onclick="set(8,${arguments[1]},true)"><img src="/src/rate_star_before_half-right.png" height="50" width="25" onclick="set(9,${arguments[1]},false)">`
        case 6: return `
            <img src="/src/rate_star_after_half-left.png" height="50" width="25" onclick="set(0,${arguments[1]},true)"><img src="/src/rate_star_after_half-right.png" height="50" width="25" onclick="set(1,${arguments[1]},false)">
            <img src="/src/rate_star_after_half-left.png" height="50" width="25" onclick="set(2,${arguments[1]},true)"><img src="/src/rate_star_after_half-right.png" height="50" width="25" onclick="set(3,${arguments[1]},false)">
            <img src="/src/rate_star_after_half-left.png" height="50" width="25" onclick="set(4,${arguments[1]},true)"><img src="/src/rate_star_after_half-right.png" height="50" width="25" onclick="set(5,${arguments[1]},false)">
            <img src="/src/rate_star_after_half-left.png" height="50" width="25" onclick="set(6,${arguments[1]},true)"><img src="/src/rate_star_before_half-right.png" height="50" width="25" onclick="set(7,${arguments[1]},false)">
            <img src="/src/rate_star_before_half-left.png" height="50" width="25" onclick="set(8,${arguments[1]},true)"><img src="/src/rate_star_before_half-right.png" height="50" width="25" onclick="set(9,${arguments[1]},false)">`
        case 7: return `
            <img src="/src/rate_star_after_half-left.png" height="50" width="25" onclick="set(0,${arguments[1]},true)"><img src="/src/rate_star_after_half-right.png" height="50" width="25" onclick="set(1,${arguments[1]},false)">
            <img src="/src/rate_star_after_half-left.png" height="50" width="25" onclick="set(2,${arguments[1]},true)"><img src="/src/rate_star_after_half-right.png" height="50" width="25" onclick="set(3,${arguments[1]},false)">
            <img src="/src/rate_star_after_half-left.png" height="50" width="25" onclick="set(4,${arguments[1]},true)"><img src="/src/rate_star_after_half-right.png" height="50" width="25" onclick="set(5,${arguments[1]},false)">
            <img src="/src/rate_star_after_half-left.png" height="50" width="25" onclick="set(6,${arguments[1]},true)"><img src="/src/rate_star_after_half-right.png" height="50" width="25" onclick="set(7,${arguments[1]},false)">
            <img src="/src/rate_star_before_half-left.png" height="50" width="25" onclick="set(8,${arguments[1]},true)"><img src="/src/rate_star_before_half-right.png" height="50" width="25" onclick="set(9,${arguments[1]},false)">`
        case 8: return `
            <img src="/src/rate_star_after_half-left.png" height="50" width="25" onclick="set(0,${arguments[1]},true)"><img src="/src/rate_star_after_half-right.png" height="50" width="25" onclick="set(1,${arguments[1]},false)">
            <img src="/src/rate_star_after_half-left.png" height="50" width="25" onclick="set(2,${arguments[1]},true)"><img src="/src/rate_star_after_half-right.png" height="50" width="25" onclick="set(3,${arguments[1]},false)">
            <img src="/src/rate_star_after_half-left.png" height="50" width="25" onclick="set(4,${arguments[1]},true)"><img src="/src/rate_star_after_half-right.png" height="50" width="25" onclick="set(5,${arguments[1]},false)">
            <img src="/src/rate_star_after_half-left.png" height="50" width="25" onclick="set(6,${arguments[1]},true)"><img src="/src/rate_star_after_half-right.png" height="50" width="25" onclick="set(7,${arguments[1]},false)">
            <img src="/src/rate_star_after_half-left.png" height="50" width="25" onclick="set(8,${arguments[1]},true)"><img src="/src/rate_star_before_half-right.png" height="50" width="25" onclick="set(9,${arguments[1]},false)">`
        case 9: return `
            <img src="/src/rate_star_after_half-left.png" height="50" width="25" onclick="set(0,${arguments[1]},true)"><img src="/src/rate_star_after_half-right.png" height="50" width="25" onclick="set(1,${arguments[1]},false)">
            <img src="/src/rate_star_after_half-left.png" height="50" width="25" onclick="set(2,${arguments[1]},true)"><img src="/src/rate_star_after_half-right.png" height="50" width="25" onclick="set(3,${arguments[1]},false)">
            <img src="/src/rate_star_after_half-left.png" height="50" width="25" onclick="set(4,${arguments[1]},true)"><img src="/src/rate_star_after_half-right.png" height="50" width="25" onclick="set(5,${arguments[1]},false)">
            <img src="/src/rate_star_after_half-left.png" height="50" width="25" onclick="set(6,${arguments[1]},true)"><img src="/src/rate_star_after_half-right.png" height="50" width="25" onclick="set(7,${arguments[1]},false)">
            <img src="/src/rate_star_after_half-left.png" height="50" width="25" onclick="set(8,${arguments[1]},true)"><img src="/src/rate_star_after_half-right.png" height="50" width="25" onclick="set(9,${arguments[1]},false)">`
        default:
            break
    }
}
function makeDiv() {
    return `
          <div style="height: 120px;" class="list-group-item list-group-item-action py-3 lh-tight d-flex align-items-center" aria-current="true" id="${arguments[0]}">
                <div id="img_${arguments[0]}" style="display: inline-block; margin: 0;" onclick="foodInfo(${arguments[0]})" class="food-image">
                    <img src="/src/ramen.jpg" height="60" width="60">
                </div>
                <div style="width: 300px; display: inline-block; margin: 0 0 0 20px;" class="rating_content" id="content_${arguments[0]}">
                    <div class="d-flex justify-content-start fs-3" style="font-size: 25px; margin: 0px !important; padding: 0px !important;" class="food-name">
                        <span>${arguments[1]}</span>
                    </div>
                    <div class="d-flex justify-content-start fs-2 food-rating" id="rating_${arguments[0]}" style=" margin: 0px !important; padding: 0px !important;">
                        <img src="/src/rate_star_before_half-left.png" height="50" width="25" onclick="set(0,${arguments[0]},true)"><img src="/src/rate_star_before_half-right.png" height="50" width="25" onclick="set(1,${arguments[0]},false)">
                        <img src="/src/rate_star_before_half-left.png" height="50" width="25" onclick="set(2,${arguments[0]},true)"><img src="/src/rate_star_before_half-right.png" height="50" width="25" onclick="set(3,${arguments[0]},false)">
                        <img src="/src/rate_star_before_half-left.png" height="50" width="25" onclick="set(4,${arguments[0]},true)"><img src="/src/rate_star_before_half-right.png" height="50" width="25" onclick="set(5,${arguments[0]},false)">
                        <img src="/src/rate_star_before_half-left.png" height="50" width="25" onclick="set(6,${arguments[0]},true)"><img src="/src/rate_star_before_half-right.png" height="50" width="25" onclick="set(7,${arguments[0]},false)">
                        <img src="/src/rate_star_before_half-left.png" height="50" width="25" onclick="set(8,${arguments[0]},true)"><img src="/src/rate_star_before_half-right.png" height="50" width="25" onclick="set(9,${arguments[0]},false)">
                    </div>
                </div>
            </div>`
}

async function init() {
    foods={}
    let postJson={}
    postJson[0]=2
    postJson[1]="food.id, name, image, userid, rating"
    postJson[2]="food,rating"
    postJson[3]=`food.id=rating.foodid and userid=${id};`

    rating_info=JSON.parse(await $.ajax({type: "POST", url: '/script/php/DAOHandler.php', data: postJson}))

    postJson[0]=2
    postJson[1]="*"
    postJson[2]="food"
    postJson[3]=`1>0;`

    src=JSON.parse(await $.ajax({type: "POST", url: '/script/php/DAOHandler.php', data: postJson}))


    let inner=''
    if(rating_info.length===0) {
        for(let i=0;i<20;i++) {
            foods[src[i][0]]=src[i][1]
            inner+=makeDiv(src[i][0],src[i][1])
        }
        document.getElementById('scroll_layout').innerHTML=inner
        document.getElementById('scroll_layout').innerHTML+=loading
    }
    else {
        for(let i=0;i<rating_info.length;i++) {
            rating_info_json[rating_info[i][0]]={
                name:rating_info[i][1],
                userId:rating_info[i][3],
                rating:rating_info[i][4]
            }
        }
        keys=Object.keys(rating_info_json)
        for(let i=0;i<20;i++) {
            foods[src[i][0]]=src[i][1]
            inner+=makeDiv(src[i][0],src[i][1])
        }
        document.getElementById('scroll_layout').innerHTML=inner
        for(let i=0;i<20;i++) {
            let obj=rating_info_json[keys[i]]
            set_init(obj.rating-1,keys[i])
        }
        document.getElementById('scroll_layout').innerHTML+=loading
    }
    ratingIdx+=20
}
async function foodInfo() {

    var form = document.createElement("form");

    form.setAttribute("type", "hidden");
    form.setAttribute("id","food-info")
    form.setAttribute("action","foodinfo.php")
    form.setAttribute("method","post")

    var input = document.createElement("input")

    input.setAttribute("type", "hidden");
    input.setAttribute("name", "foodid");
    input.setAttribute("value", arguments[0]);

    form.appendChild(input)
    document.getElementById(`img_${arguments[0]}`).appendChild(form)

    document.getElementById("food-info").submit()

}

async function set() {
    score=arguments[0]+1

    let postJson={}
    postJson[0]=2
    postJson[1]='*'
    postJson[2]='rating'
    postJson[3]=`userid=${id} and foodid=${arguments[1]}`

    let set_info=JSON.parse(await $.ajax({type: "POST", url: '/script/php/DAOHandler.php', data: postJson}))

    if(set_info.length>0) {
        postJson[0]=3
        postJson[1]='rating'
        postJson[2]=`rating=${score}`
        postJson[3]=`userid=${id} and foodid=${arguments[1]}`
        await $.ajax({type: "POST", url: '/script/php/DAOHandler.php', data: postJson})
    }
    else {
        postJson[0]=1
        postJson[1]='rating(userid,foodid,rating)'
        postJson[2]=`${id},${arguments[1]},${score}`
        await $.ajax({type: "POST", url: '/script/php/DAOHandler.php', data: postJson})
    }

    document.getElementById('rating_'+arguments[1]).innerHTML=getScore(arguments[0],arguments[1])
}
function set_init() {
    console.log(arguments)
    try {
        score=arguments[0]+1
        document.getElementById('rating_'+arguments[1]).innerHTML=getScore(arguments[0],arguments[1])
    }
    catch (e) {
        console.log(arguments)
    }
}
function refresh() {
    foods={}
    if(lim===src.length) { return }
    document.getElementById('scroll_layout').innerHTML=rating_placeHolder
    if((ratingIdx+20)>=src.length) {
        lim=src.length
    }
    else {
        lim=ratingIdx+20
    }
    let inner=''
    if(rating_info.length===0) {
        for(let i=ratingIdx;i<lim;i++) {
            foods[src[i][0]]=src[i][1]
            inner+=makeDiv(src[i][0],src[i][1])
        }
        document.getElementById('scroll_layout').innerHTML=inner
        document.getElementById('scroll_layout').innerHTML+=loading
    }
    else {
        for(let i=ratingIdx;i<lim;i++) {
            foods[src[i][0]]=src[i][1]
            inner+=makeDiv(src[i][0],src[i][1])
        }
        document.getElementById('scroll_layout').innerHTML=inner
        let foodKeys=Object.keys(foods)
        for(let i=0;i<foodKeys.length;i++) {
            if(rating_info_json[foodKeys[i]]!==undefined) {

                set_init((rating_info_json[foodKeys[i]].rating)-1,foodKeys[i])
            }
        }
        document.getElementById('scroll_layout').innerHTML+=loading
    }
    ratingIdx+=20
    flag=false
}